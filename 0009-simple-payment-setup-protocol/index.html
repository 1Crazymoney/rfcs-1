<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Simple Payment Setup Protocol (SPSP) | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
              
                <li class="nav-label">
                  <a href="#preface">Preface</a>
                </li>
              
                <li class="nav-label">
                  <a href="#introduction">Introduction</a>
                </li>
              
                <li>
                  <a href="#motivation">Motivation</a>
                </li>
              
                <li>
                  <a href="#scope">Scope</a>
                </li>
              
                <li>
                  <a href="#interfaces">Interfaces</a>
                </li>
              
                <li>
                  <a href="#operation">Operation</a>
                </li>
              
                <li>
                  <a href="#definitions">Definitions</a>
                </li>
              
                <li class="nav-label">
                  <a href="#overview">Overview</a>
                </li>
              
                <li>
                  <a href="#relation-to-other-protocols">Relation to Other Protocols</a>
                </li>
              
                <li>
                  <a href="#model-of-operation">Model of Operation</a>
                </li>
              
                <li class="nav-label">
                  <a href="#specification">Specification</a>
                </li>
              
                <li>
                  <a href="#query-get-spsp-endpoint">Query (GET &lt;SPSP Endpoint&gt;)</a>
                </li>
              
                <li>
                  <a href="#payment-setup">Payment Setup</a>
                </li>
              
                <li class="nav-label">
                  <a href="#appendix-a-optional-webfinger-discovery">Appendix A: (Optional) Webfinger Discovery</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
          <h1 id="simple-payment-setup-protocol-spsp">Simple Payment Setup Protocol (SPSP)</h1>
<h2 id="preface">Preface</h2>
<p class="intro">This document describes the Simple Payment Setup Protocol (SPSP), a basic protocol for exchanging payment information between senders and receivers to set up an Interledger payment. SPSP uses the <a href="../0016-pre-shared-key/0016-pre-shared-key.md">Pre-Shared Key (PSK)</a> transport protocol for condition generation and data encoding.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="motivation">Motivation</h3>
<p>The Interledger Protocol does not specify how payment details, such as the ILP Packet or Crypto Condition, should be exchanged between the sender and receiver. SPSP is a minimal protocol that uses HTTPS for communicating these details.</p>
<h3 id="scope">Scope</h3>
<p>SPSP provides for exchanging basic receiver details needed by a sender to set up an ILP payment. It is intended for use by end-user applications.</p>
<h3 id="interfaces">Interfaces</h3>
<p>SPSP may be used by end-user applications, such as a digital wallet with a user interface for the sender to initiate payments. SPSP clients and receivers use ILP modules to send and receive Interledger payments.</p>
<p>SPSP messages MUST be exchanged over HTTPS.</p>
<h3 id="operation">Operation</h3>
<p>Any SPSP receiver will run an SPSP server and expose an HTTPS endpoint called the SPSP Endpoint. The sender can query this endpoint to get information about the type of payment that can be made to this receiver. The sender can set up and send multiple ILP payments using the details provided by the receiver.</p>
<h3 id="definitions">Definitions</h3>
<ul>
<li><strong>SPSP Client</strong> - The sender application that uses SPSP to interact with the SPSP Server</li>
<li><strong>SPSP Server</strong> - The server used on the receiver&apos;s side to handle SPSP requests</li>
<li><strong>SPSP Endpoint</strong> - The specific HTTPS endpoint on the SPSP server used for setting up a payment</li>
<li><strong>PSK Module</strong> - Software included in the SPSP Client and Server that implements the <a href="../0016-pre-shared-key/0016-pre-shared-key.md">Pre-Shared Key</a> protocol</li>
</ul>
<h2 id="overview">Overview</h2>
<h3 id="relation-to-other-protocols">Relation to Other Protocols</h3>
<p>SPSP is used for exchanging payment information before an ILP payment is initiated. The sender and receiver use the <a href="../0016-pre-shared-key/0016-pre-shared-key.md">Pre-Shared Key (PSK)</a> transport protocol to generate the condition and fulfillment. The receiver generates the shared secret to be used in PSK and communicates it to the sender over HTTPS.</p>
<h3 id="model-of-operation">Model of Operation</h3>
<p>We assume that the sender knows the receiver&apos;s SPSP endpoint (see <a href="#appendix-a-optional-webfinger-discovery">Appendix A: (Optional) Webfinger Discovery</a>).</p>
<ol>
<li>The sender&apos;s SPSP Client queries the receiver&apos;s SPSP Endpoint.</li>
<li>The SPSP Endpoint responds with the receiver info, including the receiver&apos;s ILP address and the shared secret to be used in PSK.</li>
<li>The sender constructs an ILP payment using the receiver&apos;s ILP address.</li>
<li>The sender uses PSK to generate the payment condition and format additional data intended for the reciever to be sent with the payment.</li>
<li>The sender prepares a local transfer to a connector with the condition and ILP packet attached.</li>
<li>The receiver&apos;s PSK module registers the incoming transfer, parses and validates the ILP packet and the incoming transfer.</li>
<li>The receiver MAY submit the incoming payment to an external system for review to ensure that the funds are wanted.</li>
<li>If the payment is expected, the receiver&apos;s PSK module submits the condition fulfillment to the ledger to execute the transfer. If not, the PSK module rejects the incoming transfer.</li>
<li>If the receiver executed the transfer, the sender&apos;s SPSP client receives a notification from its ILP module that the transfer has been executed, including the condition fulfillment from the receiver, and notifies the sender that the payment is completed. If the receiver rejected the transfer, the sender&apos;s SPSP client receives a notification with the receiver-specified error message detailing why the payment was rejected.</li>
</ol>
<h2 id="specification">Specification</h2>
<p>The SPSP endpoint is a URI used by the sender to query information about the sender and set up payments. The SPSP endpoint URI MAY contain query string parameters. The sender SHOULD treat the URI as opaque.</p>
<p>The SPSP Endpoint MUST respond to HTTPS <code>GET</code> requests in the following manner:</p>
<h3 id="query-get-spsp-endpoint">Query (<code>GET &lt;SPSP Endpoint&gt;</code>)</h3>
<p>The sender queries the SPSP endpoint to get information about the type of payment that can be made to this receiver:</p>
<h4 id="request">Request</h4>
<pre><code class="lang-http">GET /api/spsp/bob HTTP/1.1
Host: red.ilpdemo.org
Accept: application/json
</code></pre>
<h4 id="response">Response</h4>
<pre><code class="lang-http">HTTP/1.1 200 OK
Content-Type: application/json

{
  &quot;destination_account&quot;: &quot;example.ilpdemo.red.bob&quot;,
  &quot;shared_secret&quot;: &quot;6jR5iNIVRvqeasJeCty6C-YB5X9FhSOUPCL_5nha5Vs&quot;,
  &quot;maximum_destination_amount&quot;: &quot;100000&quot;,
  &quot;minimum_destination_amount&quot;: &quot;10&quot;,
  &quot;ledger_info&quot;: {
    &quot;currency_code&quot;: &quot;USD&quot;,
    &quot;currency_symbol&quot;: &quot;$&quot;,
    &quot;scale&quot;: 2,
    &quot;precision&quot;: 10
  },
  &quot;receiver_info&quot;: {
    &quot;name&quot;: &quot;Bob Dylan&quot;,
    &quot;image_url&quot;: &quot;https://red.ilpdemo.org/api/spsp/bob/profile_pic.jpg&quot;
  }
}
</code></pre>
<p><a href="https://red.ilpdemo.org/api/receivers/bob">Try this request</a></p>
<h5 id="response-headers">Response Headers</h5>
<p>The response MUST contain at least the following headers:</p>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Header</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Content-Type</code></td>
<td style="text-align:left">MUST be <code>application/json</code> to indicates the response is encoded as <a href="http://www.json.org/">JSON</a>.</td>
</tr>
<tr>
<td style="text-align:left"><code>Cache-Control</code></td>
<td style="text-align:left">Indicates how long the SPSP Client should cache the response. See supported cache-control directives below.</td>
</tr>
</tbody>
</table>
<p>To handle as many transactions per second as possible, the SPSP Client caches results from the SPSP Server. The information returned by the SPSP Server is not expected to change rapidly, so repeated requests for the same information are usually redundant. The server communicates how long to cache results for using the HTTP-standard <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control"><code>Cache-Control</code> header</a> in the responses to RESTful API calls.</p>
<p>The SPSP Client understands the following Cache-Control directives:</p>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Directive</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>max-age=&lt;i&gt;</code></td>
<td style="text-align:left">The client should cache this response for <code>&lt;i&gt;</code> seconds. <code>&lt;i&gt;</code> MUST be a positive integer</td>
</tr>
<tr>
<td style="text-align:left"><code>no-cache</code></td>
<td style="text-align:left">The client must not cache this response</td>
</tr>
</tbody>
</table>
<h5 id="response-body">Response Body</h5>
<p>The response body is a JSON object that includes basic account details necessary for setting up payments.</p>
<table class="table table-striped">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>destination_account</code></td>
<td><a href="../0015-ilp-addresses/0015-ilp-addresses.md">ILP Address</a></td>
<td>ILP Address of the receiver&apos;s account</td>
</tr>
<tr>
<td><code>shared_secret</code></td>
<td>32 bytes, <a href="https://en.wikipedia.org/wiki/Base64#URL_applications">base64-url encoded</a></td>
<td>The shared secret to be used in the <a href="../0016-pre-shared-key/0016-pre-shared-key.md">Pre-Shared Key protocol</a></td>
</tr>
<tr>
<td><code>maximum_destination_amount</code></td>
<td>Integer String</td>
<td>Maximum amount, denoted in the minimum divisible units of the ledger, the receiver will accept. This amount may be determined by the ledger&apos;s maximum account balance or transfer amount. If the receiver expects a specific amount to be delivered, this may be set equal to the <code>minimum_destination_amount</code></td>
</tr>
<tr>
<td><code>minimum_destination_amount</code></td>
<td>Integer String</td>
<td>Minimum amount, denoted in the minimum divisible units of the ledger, the receiver will accept. This amount may be determined by the minimum transfer amount of the ledger. If the receiver expects a specific amounts to be delivered, this may be set equal to the <code>maximum_destination_amount</code></td>
</tr>
<tr>
<td><code>ledger_info</code></td>
<td>Object</td>
<td>Details about the destination ledger</td>
</tr>
<tr>
<td><code>ledger_info.currency_code</code></td>
<td>String</td>
<td>Currency code to identify the receiver&apos;s currency. Currencies that have <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> codes should use those. Sender UIs SHOULD be able to render non-standard codes</td>
</tr>
<tr>
<td><code>ledger_info.currency_symbol</code></td>
<td>String</td>
<td>Symbol for the receiver&apos;s currency intended for display in the sender&apos;s UI (e.g. <code>&quot;$&quot;</code> or <code>&quot;shares&quot;</code>). Sender UIs SHOULD be able to render non-standard symbols</td>
</tr>
<tr>
<td><code>ledger_info.scale</code></td>
<td>Integer</td>
<td>The scale of the amounts on the destination ledger (e.g. an amount of <code>&quot;1000&quot;</code> with a scale of <code>2</code> translates to <code>10.00</code> units of the destination ledger&apos;s currency)</td>
</tr>
<tr>
<td><code>ledger_info.precision</code></td>
<td>Integer</td>
<td>The maximum precision supported by the ledger</td>
</tr>
<tr>
<td><code>receiver_info</code></td>
<td>Object</td>
<td>Arbitrary additional information about the receiver. This field has no schema and the receiver may include any fields they choose. The field names listed below are recommended merely for interoperability purposes.</td>
</tr>
<tr>
<td><code>receiver_info.name</code></td>
<td>String</td>
<td><em>(OPTIONAL)</em> Full name of the individual, company or organization the receiver represents</td>
</tr>
<tr>
<td><code>receiver_info.image_url</code></td>
<td>HTTPS URL</td>
<td><em>(OPTIONAL)</em> URL where the sender can get a picture representation of the receiver</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Currency amounts are denominated as integer strings instead of native JSON numbers to avoid losing precision during JSON parsing. Applications MUST represent these numbers in a data type that has precision equal or greater than an unsigned 64-bit integer.</p>
<h5 id="errors">Errors</h5>
<h6 id="receiver-does-not-exist">receiver Does Not Exist</h6>
<pre><code class="lang-http">HTTP/1.1 404 Not Found
Content-Type: application/json

{
  &quot;id&quot;: &quot;InvalidReceiverError&quot;,
  &quot;message&quot;: &quot;Invalid receiver ID&quot;
}
</code></pre>
<h3 id="payment-setup">Payment Setup</h3>
<p>The sender uses the receiver details to create the ILP packet:</p>
<ul>
<li>The <code>account</code> in the ILP packet is the <code>destination_account</code> provided by the receiver</li>
<li><p>The <code>amount</code> is determined by the sender:</p>
<ul>
<li>The sender uses the <code>ledger_info.scale</code> to determine the integer amount to include in the ILP packet (e.g. if they want the receiver to receive 10 units on their ledger, a <code>ledger_info.scale</code> value of 2 would indicate they should set the <code>amount</code> to 1000). In cases where the sender knows the integer amount the receiver should get, for example if that amount was requested by the receiver out of band, the sender does not need to use the <code>ledger_info.scale</code></li>
<li>The sender SHOULD NOT set an amount greater than the <code>maximum_destination_amount</code> or lower than the <code>minimum_destination_amount</code>, as this will be rejected by the receiver</li>
<li>The sender SHOULD NOT set an amount with a precision greater than the <code>ledger_info.precision</code>, as this will be rejected by the destination ledger</li>
</ul>
</li>
<li><p>The <code>data</code> is encoded using the <a href="../0016-pre-shared-key/0016-pre-shared-key.md">Pre-Shared Key protocol</a>:</p>
<ul>
<li>The key is the <code>shared_secret</code> provided by the receiver</li>
<li>Additional data may be included in the PSK details. SPSP data MUST be JSON.</li>
<li>Private PSK headers SHOULD include <code>Content-Type: application/json</code> and <code>Content-Length: &lt;byte length of data&gt;</code></li>
</ul>
</li>
</ul>
<p>Note that the sender can send as many payments as they want using the same receiver info. The sender SHOULD query the receiver again once the time indicated in the <a href="#response-headers"><code>Cache-Control</code> header</a> has passed.</p>
<h2 id="appendix-a-optional-webfinger-discovery">Appendix A: (Optional) Webfinger Discovery</h2>
<p>Whenever possible, receiver URLs should be exchanged out-of-band and discovery should be skipped. However, in some cases, it may be useful to have a standardized user-friendly identifier. This discovery method describes how to resolve such an identifier to an SPSP endpoint.</p>
<p>First, the sender uses Webfinger (<a href="https://tools.ietf.org/html/rfc7033">RFC 7033</a>) to look up an identifier (e.g. <code>bob@red.ilpdemo.org</code>):</p>
<pre><code class="lang-http">GET /.well-known/webfinger?resource=acct%3Abob%40red.ilpdemo.org HTTP/1.1
Host: red.ilpdemo.org
Accept: application/json
</code></pre>
<pre><code class="lang-http">HTTP/1.1 200 OK
Content-Type: application/json

{
  &quot;subject&quot;: &quot;acct:bob@red.ilpdemo.org&quot;,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;https://interledger.org/rel/spsp/v2&quot;,
      &quot;href&quot;: &quot;https://red.ilpdemo.org/api/spsp/bob&quot;
    }
  ]
}
</code></pre>
<p><a href="https://red.ilpdemo.org/.well-known/webfinger?resource=acct%3Abob%40red.ilpdemo.org">Try this request</a></p>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
