<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>The Connector to Connector protocol | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
                <li class="nav-label">
                  <a href="./draft-FINAL.html">ILP-RFC 0010 Draft FINAL</a>
                </li>
                <li>
                  <a href="./draft-FINAL.html">Permalink to this Draft</a>
                </li>
                <li>
                  <a href="./">View the Latest Draft of ILP-RFC 0010</a>
                </li>
              
                <li class="nav-label">
                  <a href="#discovery">Discovery</a>
                </li>
              
                <li>
                  <a href="#webfinger-based-discovery">WebFinger-based discovery</a>
                </li>
              
                <li>
                  <a href="#discovery-without-webfinger">Discovery without WebFinger</a>
                </li>
              
                <li class="nav-label">
                  <a href="#route-broadcasts">Route broadcasts</a>
                </li>
              
                <li class="nav-label">
                  <a href="#please-expand-this-document">Please expand this document</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
                      <p class="alert alert-warning" style="margin-top: 35px">
            <strong>This specification has been deprecated.</strong>
                        
          </p>
                      <p class="intro"><strong>A well-defined standard for automatic discovery of peers has not been taken up in the network. As such this spec has been deprecated to avoid confusion.</strong></p>
<h1 id="connector-to-connector-protocol">Connector to Connector protocol</h1>
<h2 id="discovery">Discovery</h2>
<p>Connectors discover their peers through out-of-band communication, or by looking at <a href="https://connector.land">https://connector.land</a> and contacting the administrator of another connector.</p>
<p>Once peered, two connectors have a ledger between them.</p>
<p>There are two ways for connectors to peer with each other: symmetric, and asymmetric. In symmetric peering, the ledger between the two connectors is administered
collaboratively by the two connectors, optionally relying on a trusted third party (validator). In asymmetric peering, the ledger is administered by one of the two
peers, and the other peer only keeps a non-authoritative shadow ledger.</p>
<p>Regardless of whether the connectors peer symmetrically or asymmetrically, the initiating connector somehow needs to exchange information with the other connector.
WebFinger can help with that.</p>
<p>Whether discovery is done with or without use of WebFinger, each peer ends up knowing:</p>
<ul>
<li>the protocol to use to send information like route broadcasts to the other connector</li>
<li>the protocol to use to add updates to the peering ledger</li>
<li>the currency code for the peering ledger</li>
<li>the currency scale for the peering ledger</li>
</ul>
<h3 id="webfinger-based-discovery">WebFinger-based discovery</h3>
<p>In WebFinger-based discovery, both peers still need some out-of-band communication channel (e.g. talking in person or over email/chat), over which one
prospective peer tells the other:</p>
<ul>
<li>their intent, &quot;Let&apos;s peer using WebFinger!&quot;</li>
<li>their own hostname</li>
<li>the currency code they propose for the peer ledger</li>
<li>the ledger scale they propose for the peer ledger</li>
</ul>
<p>And the other peer response with:</p>
<ul>
<li>their agreement, &quot;OK, let&apos;s peer using WebFinger for discover, and using that currency code and scale for the peer ledger!&quot;</li>
<li>their own hostname</li>
</ul>
<p>Now, both peers look up each other&apos;s host resource, for instance:</p>
<ul>
<li>the server wallet1.com looks up <a href="https://wallet2.com/.well-known/webfinger?resource=https://wallet2.com">https://wallet2.com/.well-known/webfinger?resource=https://wallet2.com</a></li>
<li>the server wallet2.com looks up <a href="https://wallet1.com/.well-known/webfinger?resource=https://wallet1.com">https://wallet1.com/.well-known/webfinger?resource=https://wallet1.com</a></li>
</ul>
<p>This way, each peer has the other peer&apos;s public key. They now use ECDH to create a shared secret, from which a ledger prefix and an auth token are derived,
as implemented in <a href="https://github.com/interledgerjs/ilp-kit">ilp-kit</a>.</p>
<h3 id="discovery-without-webfinger">Discovery without WebFinger</h3>
<p>When the two connectors do their discovery without WebFinger, the first peer tells the other:</p>
<ul>
<li>their intent, &quot;Let&apos;s peer without WebFinger!&quot;</li>
<li>a BTP URI for the other connector to use</li>
<li>a BTP version to use (currently &apos;BTP/1.0&apos;)</li>
<li>the currency code they propose for the peer ledger</li>
<li>the ledger scale they propose for the peer ledger</li>
</ul>
<p>And the other peer responds by connecting to the WebSocket indicated by the BTP URI and the protocol version. A BTP URI has one of the following formats:</p>
<ul>
<li><code>btp+&lt;protocol&gt;://&lt;auth_username&gt;:&lt;auth_token&gt;@&lt;url&gt;</code></li>
<li><code>btp+&lt;protocol&gt;://&lt;auth_username&gt;@&lt;url&gt;</code> // <code>auth_token === &apos;&apos;</code> is implied</li>
<li><code>btp+&lt;protocol&gt;://&lt;url&gt;</code> // <code>auth_username === &apos;&apos;</code> and <code>auth_token === &apos;&apos;</code> are implied</li>
</ul>
<p>The <code>&lt;protocol&gt;</code> is either &apos;ws&apos; or &apos;wss&apos;. The <code>&lt;url&gt;</code> needs to contain a hostname, and may contain a port identifier and path part.</p>
<p>Examples:</p>
<ul>
<li>&apos;btp+ws://localhost:8000&apos;</li>
<li>&apos;btp+wss://someUsername:<a href="mailto:someToken@amundsen.michielbdejong.com">someToken@amundsen.michielbdejong.com</a>/api/17q3&apos;</li>
</ul>
<p>Both connector-to-connector messages and ledger updates will then be transported over the BTP WebSocket.</p>
<p>Note that one peer will play the role of WebSocket server, and the other peer will play the role of WebSocket client. Often, but not necessarily, the peer
playing the server role will also administer the peer ledger, and the peer playing the client role will only keep a shadow ledger.</p>
<h2 id="route-broadcasts">Route broadcasts</h2>
<p>Connectors send each other <code>broadcast_routes</code> messages, using the message sending functionality of the ledger between them.</p>
<p>The syntax of such a method is defined by <a href="https://github.com/interledgerjs/ilp-connector/blob/v17.0.2/schemas/RoutingUpdate.json">https://github.com/interledgerjs/ilp-connector/blob/v17.0.2/schemas/RoutingUpdate.json</a> and
 <a href="https://github.com/interledgerjs/five-bells-shared/blob/v22.0.1/schemas/Routes.json">https://github.com/interledgerjs/five-bells-shared/blob/v22.0.1/schemas/Routes.json</a>.</p>
<p>When a route is included in a route update from Alice to Bob, Alice is stating she will, at least temporarily, be able to forward a payment to that destination, if the
source amount which Bob would send her is high enough, given the destination amount, and as described by the <code>points</code> piece-wise linear function.</p>
<p>Connectors also exchange quote requests,
in the same way users may request a quote from a connector, see <a href="../0008-interledger-quoting-protocol">IL-RFC 8</a>.
This process is called remote quoting.</p>
<p>Note that the points series (&quot;liquidity curves&quot;) in route broadcasts, as well as the
amounts in quote requests and quote responses, are expressed in integer values in the ledger&apos;s base unit of the ledger. This means you will need to divide/multiply
by <code>10 ** currency_scale</code> for the ledger in question, to convert integers (in ledger units) to floats (in terms of the ledger&apos;s announced <code>currency_code</code>), and back.</p>
<p>The curve from the route broadcast is used directly for determining a source amount / destination amount relation, and remote quoting is only used when
a connector knows about a route without knowing its curve information (this can happen if a connector somewhere in the network was explicitly configured with a hard-wired
(default) route in its ilp-connector config; that route then also gets forwarded without curve in route broadcasts across the network, and all connectors that want to use this
route will therefore need to use remote quoting).
All routes that were built up from local pairs will however get broadcast including their curves, based on connector fees, currency exchange rates, and liquidity limits (min and
max limits on the connector&apos;s balance on both ledgers) and this requires routes to be re-broadcast when their liquidity curve changes, but ilp-kit will aggregate over time, both
for its own liquidity changes, and route changes which it forwards, into one message per 30 seconds.</p>
<p>When combining various alternative (parallel) routes, for each section of the liquidity curve, ilp-kit will only consider routes which are as short as the shortest known route,
and from the set of shortest paths, choose the cheapest one. Note that the routing table of each ilp-kit is used for two things:</p>
<ul>
<li>determine whether a payment&apos;s source amount is sufficient or not, given its destination amount</li>
<li>if so, choose the next hop (it&apos;s then up to that peer to choose the hop after that, until the destination node is reached)</li>
</ul>
<h2 id="please-expand-this-document">Please expand this document</h2>
<p>This document is a stub, please help expand it! See <a href="https://github.com/interledger/rfcs">https://github.com/interledger/rfcs</a>.</p>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
