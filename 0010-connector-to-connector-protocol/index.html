<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Connector to Connector protocol | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
              
                <li class="nav-label">
                  <a href="#discovery">Discovery</a>
                </li>
              
                <li class="nav-label">
                  <a href="#route-broadcasts">Route broadcasts</a>
                </li>
              
                <li>
                  <a href="#current-situation-gratuity-quoting">Current situation: gratuity quoting</a>
                </li>
              
                <li>
                  <a href="#next-version-liquidity-routing">Next version: Liquidity Routing</a>
                </li>
              
                <li class="nav-label">
                  <a href="#please-expand-this-document">Please expand this document</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
          <h1 id="connector-to-connector-protocol">Connector to Connector protocol</h1>
<h2 id="discovery">Discovery</h2>
<p class="intro">Connectors discover their peers through out-of-band communication, or by looking at <a href="https://connector.land">https://connector.land</a> and contacting the administrator of another connector.</p>
<p>Once peered, two connectors have a ledger between them; this is often a ledger with just two accounts, often administered collaboratively by the two connectors.</p>
<h2 id="route-broadcasts">Route broadcasts</h2>
<p>Connectors send each other <code>broadcast_routes</code> messages, using the message sending functionality of the ledger between them.</p>
<p>The syntax of such a method is defined by <a href="https://github.com/interledgerjs/ilp-connector/blob/v17.0.2/schemas/RoutingUpdate.json">https://github.com/interledgerjs/ilp-connector/blob/v17.0.2/schemas/RoutingUpdate.json</a> and
 <a href="https://github.com/interledgerjs/five-bells-shared/blob/v22.0.1/schemas/Routes.json">https://github.com/interledgerjs/five-bells-shared/blob/v22.0.1/schemas/Routes.json</a>.</p>
<p>When a route is included in a route update from Alice to Bob, Alice is stating she will, at least temporarily, be able to forward a payment to that destination, if the
source amount which Bob would send her is high enough, given the destination amount, and as described by the <code>points</code> piece-wise linear function.</p>
<p>Connectors also exchange quote requests,
in the same way users may request a quote from a connector, see <a href="../0008-interledger-quoting-protocol">IL-RFC 8</a>.
This process is called remote quoting.</p>
<p>Note that the points series (&quot;liquidity curves&quot;) in route broadcasts, as well as the
amounts in quote requests and quote responses, are expressed in integer values in the ledger&apos;s base unit of the ledger. This means you will need to divide/multiply
by <code>10 ** currency_scale</code> for the ledger in question, to convert integers (in ledger units) to floats (in terms of the ledger&apos;s announced <code>currency_code</code>), and back.</p>
<h3 id="current-situation-gratuity-quoting">Current situation: gratuity quoting</h3>
<p>Even though the first connector has a complete copy of all the liquidity curves, these curves might be out of date; they are used
to determine the best route, but not to determine which combination of source amount and destination amount the sender should use for a specific payment.
This situation allows each connector along the path to charge a &quot;gratuity&quot; in the quote, which was not included in the broadcasted curve, like the one that sometimes included
in the bill in a restaurant, on top of the price that was quoted in the menu.</p>
<p>Although this strategy works well in closed networks where each participant is vetted and can be trusted, it is known to be sub-optimal for use in an open network where connectors
may try to earn extra money by charging a higher fee than the cost price. Therefore, this &quot;gratuity quoting&quot; strategy used by the ilp-kit/ilp-connector reference implementation is
likely to change in the future, and one proposal is currently being developed.</p>
<h3 id="next-version-liquidity-routing">Next version: Liquidity Routing</h3>
<p>In Liquidity Routing, the curve from the route broadcast is used directly for determining a source amount / destination amount relation, and remote quoting is only used when
a (default) route was configured without curve information. This requires routes to be re-broadcast when their liquidity curve changes, but ilp-kit will aggregate over time, both
for its own liquidity changes, and route changes which it forwards, into one message per 30 seconds.</p>
<p>When combining various alternative (parallel) routes, for each section of the liquidity curve, ilp-kit will only consider routes which are as short as the shortest known route,
and from the set of shortest paths, choose the cheapest one. Note that the routing table of each ilp-kit is used for two things:</p>
<ul>
<li>determine whether a payment&apos;s source amount is sufficient or not, given its destination amount</li>
<li>if so, choose the next hop (it&apos;s then up to that peer to choose the hop after that, until the destination node is reached)</li>
</ul>
<h2 id="please-expand-this-document">Please expand this document</h2>
<p>This document is a stub, please help expand it! See <a href="https://github.com/interledger/rfcs">https://github.com/interledger/rfcs</a>.</p>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
