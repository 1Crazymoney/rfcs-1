<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Web Monetization | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
                <li class="nav-label">
                  <a href="./draft-4.html">ILP-RFC 0028 Draft 4</a>
                </li>
                <li>
                  <a href="./draft-4.html">Permalink to this Draft</a>
                </li>
                <li>
                  <a href="./">View the Latest Draft of ILP-RFC 0028</a>
                </li>
              
                <li class="nav-label">
                  <a href="#overview">Overview</a>
                </li>
              
                <li>
                  <a href="#terminology">Terminology</a>
                </li>
              
                <li>
                  <a href="#design-goals">Design Goals</a>
                </li>
              
                <li>
                  <a href="#relation-to-other-protocols">Relation to Other Protocols</a>
                </li>
              
                <li class="nav-label">
                  <a href="#flow">Flow</a>
                </li>
              
                <li>
                  <a href="#registration">Registration</a>
                </li>
              
                <li>
                  <a href="#monetization">Monetization</a>
                </li>
              
                <li class="nav-label">
                  <a href="#specification">Specification</a>
                </li>
              
                <li>
                  <a href="#browser-api--polyfill-api">Browser API / Polyfill API</a>
                </li>
              
                <li>
                  <a href="#ilp-connection-class">ILP Connection Class</a>
                </li>
              
                <li>
                  <a href="#ilp-stream-class">ILP Stream Class</a>
                </li>
              
                <li>
                  <a href="#web-monetization-handler-api">Web Monetization Handler API</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
                      <h1 id="web-monetization">Web Monetization</h1>
<p class="intro">Web Monetization is a proposed browser API that uses ILP micropayments to monetize a site. It can be provided through a polyfill or an extension, but the goal is to eventually implement it directly into the browser.</p>
<h2 id="overview">Overview</h2>
<h3 id="terminology">Terminology</h3>
<ul>
<li>The <strong>webmaster</strong> is the party who is running a site.</li>
<li>The <strong>user</strong> is the party who is accessing the site.</li>
<li>The <strong>provider</strong> is the party providing Interledger access to the user.</li>
</ul>
<h3 id="design-goals">Design Goals</h3>
<ul>
<li>Should work on mobile and desktop without requiring an extension or special browser.</li>
<li>Should be extremely simple for webmasters to use in their site.</li>
<li>Backend infrastructure should be optional; should be usable on a static site.</li>
<li>Should not require any interaction with the user.</li>
<li>Should give user&apos;s agent a choice about how much to spend, and which sites to support.</li>
<li>Should give advanced webmasters a way to associate payments with their users, in order to unlock premium experiences.</li>
<li>Should pay continuously as the user consumes content.</li>
<li>Should be compatible with existing application and transport protocols on Interledger.</li>
</ul>
<h3 id="relation-to-other-protocols">Relation to Other Protocols</h3>
<p>The reason this is not using the W3C Web Payments API is that Web Monetization is intended for continuous payments rather than discrete payments. It is also not designed to have any user interaction. The idea is to provide a direct alternative to advertisements, rather than an alternative to existing checkout methods.</p>
<p>With advertisements, the browser decides whether to display the ads and the user decides whether to engage with the ads. With Web Monetization, the browser decides whether to pay the site and, if so, how much to pay.</p>
<p>Web Monetization makes use of <a href="../0029-stream">ILP/STREAM</a> provide a high-level way to send money and data, while still providing tremendous flexibility.</p>
<h2 id="flow">Flow</h2>
<p>Web Monetization works in two stages: first, the user registers their provider with their browser. After the registration has been completed, the user can go to websites and use Web Monetization.</p>
<h3 id="registration">Registration</h3>
<ul>
<li>The user visits their provider&apos;s webpage.</li>
<li>The provider&apos;s webpage calls <code>window.WebMonetization.register</code>.</li>
<li>The browser will display a native pop-up box asking the user whether they want to set the handler proposed by the page.<ul>
<li>If the user confirms, <code>handlerUrl</code> is stored in the browser&apos;s state and <code>window.WebMonetization.register</code> resolves to true.</li>
<li>If the user cancels the registration, <code>window.WebMonetization.register</code> will resolve to false.</li>
</ul>
</li>
</ul>
<h3 id="monetization">Monetization</h3>
<ul>
<li>The user visits a webpage.</li>
<li>When the page wants to open an ILP/STREAM connection, it calls <code>window.WebMonetization.monetize()</code> with a <code>destinationAccount</code> and <code>sharedSecret</code>.<ul>
<li>The browser creates an iframe to the handler URL, reading from the state that was stored during <a href="#registration">registration</a>.</li>
<li>An ILP/STREAM connection object is returned from the function for the site to use.</li>
</ul>
</li>
<li>When the page wants to use the ILP/STREAM connection, they use the javascript STREAM API to send money and/or data. The browser sends outgoing ILP packets to the handler iframe using <code>postMessage</code>. The handler iframe forwards incoming packets by calling <code>window.parent.postMessage</code>.</li>
</ul>
<h2 id="specification">Specification</h2>
<h3 id="browser-api--polyfill-api">Browser API / Polyfill API</h3>
<h4 id="register">Register</h4>
<pre><code class="lang-ts">window.WebMonetization.register({
  name: string,
  handlerUri: string
}): Promise&lt;Boolean&gt;
</code></pre>
<h5 id="parameters-1">Parameters</h5>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">opts</td>
<td style="text-align:left"><code>Object</code></td>
<td style="text-align:left">The options for registering a handler.</td>
</tr>
<tr>
<td style="text-align:left">opts.name</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Name of the provider (for display).</td>
</tr>
<tr>
<td style="text-align:left">opts.handlerUri</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">URL to handler.</td>
</tr>
</tbody>
</table>
<h5 id="returns-1">Returns</h5>
<ul>
<li><code>Promise&lt;Boolean&gt;</code> - Whether the handler was set successfully.</li>
</ul>
<h4 id="monetize">Monetize</h4>
<pre><code class="lang-ts">window.WebMonetization.monetize({
  destinationAccount: string,
  sharedSecret: string
}): Promise&lt;IlpConnection&gt;
</code></pre>
<h5 id="parameters-2">Parameters</h5>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">opts</td>
<td style="text-align:left"><code>Object</code></td>
<td style="text-align:left">The options for creating a connection.</td>
</tr>
<tr>
<td style="text-align:left">opts.destinationAccount</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">ILP address for STREAM server.</td>
</tr>
<tr>
<td style="text-align:left">opts.sharedSecret</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Base64 representation of STREAM shared secret.</td>
</tr>
</tbody>
</table>
<h5 id="returns-2">Returns</h5>
<ul>
<li><code>Promise&lt;IlpConnection&gt;</code> - An <a href="#ilp-connection-class">ILP/STREAM connection</a> that can be used to send money and data.</li>
<li>Rejects with <code>Error</code> if the connection could not be established.</li>
<li>Rejects with <code>NoHandlerRegisteredError</code> if the browser is not enabled for Web Monetization and/or has no handler registered.</li>
</ul>
<h3 id="ilp-connection-class">ILP Connection Class</h3>
<h4 id="events-1">Events</h4>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Fields</th>
<th style="text-align:left">Emitted</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>stream</code></td>
<td style="text-align:left"><a href="#ilp-stream-class"><code>Event.stream: IlpStream</code></a></td>
<td style="text-align:left">When the other side of the connection opens a stream.</td>
</tr>
<tr>
<td style="text-align:left"><code>close</code></td>
<td style="text-align:left"></td>
<td style="text-align:left">When the connection closes.</td>
</tr>
<tr>
<td style="text-align:left"><code>error</code></td>
<td style="text-align:left"><code>Event.error: Error</code></td>
<td style="text-align:left">When an error occurs on this ILP connection.</td>
</tr>
</tbody>
</table>
<h4 id="fields-read-only-1">Fields (Read-only)</h4>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>connectionTag</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">A unique tag on this connection set at establishment.</td>
</tr>
<tr>
<td style="text-align:left"><code>lastPacketExchangeRate</code></td>
<td style="text-align:left"><code>Number</code></td>
<td style="text-align:left">Exchange rate observed on the most recent packet over this connection.</td>
</tr>
<tr>
<td style="text-align:left"><code>minimumAcceptableExchangeRate</code></td>
<td style="text-align:left"><code>Number</code></td>
<td style="text-align:left">The least favorable connection allowed on this exchange rate.</td>
</tr>
<tr>
<td style="text-align:left"><code>totalDelivered</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The amount of money sent to the destination (in destination units).</td>
</tr>
<tr>
<td style="text-align:left"><code>totalSent</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The amount of money sent to the destination (in our units).</td>
</tr>
<tr>
<td style="text-align:left"><code>totalReceived</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The amount of money received (in our units).</td>
</tr>
<tr>
<td style="text-align:left"><code>sourceAssetCode</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The three-letter asset code of the source account&apos;s units.</td>
</tr>
<tr>
<td style="text-align:left"><code>sourceAssetScale</code></td>
<td style="text-align:left"><code>Number</code></td>
<td style="text-align:left">The scale of the source account&apos;s units (i.e. if the units were cents, the scale would be <code>2</code> and the code would be <code>USD</code>)</td>
</tr>
<tr>
<td style="text-align:left"><code>destinationAssetCode</code></td>
<td style="text-align:left">`String</td>
<td style="text-align:left">undefined`</td>
<td>The three-letter asset code of the destination account&apos;s units. This may not be present, depending on the destination&apos;s STREAM version.</td>
</tr>
<tr>
<td style="text-align:left"><code>destinationAssetScale</code></td>
<td style="text-align:left">`String</td>
<td style="text-align:left">undefined`</td>
<td>The scale of the destination account&apos;s units. This may not be present, depending on the destination&apos;s STREAM version.</td>
</tr>
</tbody>
</table>
<h4 id="create-stream">Create Stream</h4>
<pre><code class="lang-ts">connection.createStream(): IlpStream
</code></pre>
<h5 id="returns-3">Returns</h5>
<ul>
<li><code>IlpStream</code> - An <a href="#ilp-stream-class">ILP Stream</a> object.</li>
</ul>
<h4 id="end-connection">End Connection</h4>
<pre><code class="lang-ts">connection.close(): void
</code></pre>
<h3 id="ilp-stream-class">ILP Stream Class</h3>
<h4 id="events-2">Events</h4>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Fields</th>
<th style="text-align:left">Emitted</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>data</code></td>
<td style="text-align:left"><code>Event.data: Uint8Array</code></td>
<td style="text-align:left">When data is received over the stream.</td>
</tr>
<tr>
<td style="text-align:left"><code>money</code></td>
<td style="text-align:left"><code>Event.amount: String</code></td>
<td style="text-align:left">When money is received over the stream.</td>
</tr>
<tr>
<td style="text-align:left"><code>outgoing_money</code></td>
<td style="text-align:left"><code>Event.amount: String</code></td>
<td style="text-align:left">When money is sent over the stream.</td>
</tr>
<tr>
<td style="text-align:left"><code>close</code></td>
<td style="text-align:left"></td>
<td style="text-align:left">When the stream is closed.</td>
</tr>
<tr>
<td style="text-align:left"><code>error</code></td>
<td style="text-align:left"><code>Event.error: Error</code></td>
<td style="text-align:left">When the stream encounters an error.</td>
</tr>
</tbody>
</table>
<h4 id="fields-read-only-2">Fields (Read-only)</h4>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The id of this stream, unique to this connection.</td>
</tr>
<tr>
<td style="text-align:left"><code>receiveMax</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The maximum amount you permit this stream to receive. Change with <code>setReceiveMax()</code></td>
</tr>
<tr>
<td style="text-align:left"><code>sendMax</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The amount you will try to send on this stream. Change with <code>setSendMax()</code></td>
</tr>
<tr>
<td style="text-align:left"><code>totalReceived</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The total amount received so far on this stream.</td>
</tr>
<tr>
<td style="text-align:left"><code>totalSent</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">The total amount sent so far on this stream.</td>
</tr>
</tbody>
</table>
<h4 id="check-if-stream-is-open">Check if Stream is Open</h4>
<pre><code class="lang-ts">stream.isOpen(): Boolean
</code></pre>
<h5 id="returns-4">Returns</h5>
<ul>
<li><code>Boolean</code>, whether the stream is open.</li>
</ul>
<h4 id="allow-money-to-be-received">Allow Money to be Received</h4>
<pre><code class="lang-ts">stream.setReceiveMax(amount: String): void
</code></pre>
<p>Sets the maximum that can be received. Must be called with
increasing values.</p>
<h5 id="parameters-3">Parameters</h5>
<ul>
<li><code>amount: String</code> - The amount to receive (in our units).</li>
</ul>
<h4 id="wait-for-money-to-be-received">Wait for Money to be Received</h4>
<pre><code class="lang-ts">stream.receiveTotal(amount: String, timeout?: Number): Promise&lt;void&gt;
</code></pre>
<p>Sets the maximum that can be received and waits until that amount has been
reached. Must be called with increasing <code>amount</code>s.</p>
<h5 id="parameters-4">Parameters</h5>
<ul>
<li><code>amount: String</code> - The amount to receive (in our units).</li>
<li><code>timeout: Number</code> - How long (in ms) to wait for this function to complete.</li>
</ul>
<h4 id="try-to-send-money">Try to Send Money</h4>
<pre><code class="lang-ts">stream.setSendMax(amount: String): Promise&lt;void&gt;
</code></pre>
<p>Sets the maximum that can be sent. The stream will send as much as the receiver
is willing to receive, up to this maximum.The stream will send as much as the
receiver is willing to receive, up to this maximum. Must be called with
increasing values.</p>
<h5 id="parameters-5">Parameters</h5>
<ul>
<li><code>amount: String</code> - The amount to send (in our units).</li>
</ul>
<h4 id="wait-for-money-to-be-sent">Wait for Money to be Sent</h4>
<pre><code class="lang-ts">stream.sendTotal(amount: String, timeout?: Number): Promise&lt;void&gt;
</code></pre>
<p>Sets the maximum that can be sent and waits until that amount has been
sent. Must be called with increasing <code>amount</code>s.</p>
<h5 id="parameters-6">Parameters</h5>
<ul>
<li><code>amount: String</code> - The amount to send (in our units).</li>
<li><code>timeout: Number</code> - How long (in ms) to wait for this function to complete.</li>
</ul>
<h4 id="send-data-on-the-stream">Send Data on the Stream</h4>
<pre><code class="lang-ts">stream.send(msg: Uint8Array | String): Promise&lt;void&gt;
</code></pre>
<p>Sends data over the stream, which will be emitted as <code>data</code> events on the other
side. The data may be broken into chunks or buffered; one <code>send</code> call doesn&apos;t
necessarily correspond to a single <code>data</code> event.</p>
<h5 id="parameters-7">Parameters</h5>
<ul>
<li><code>msg: Uint8Array | String</code> - The data to send over the stream.</li>
</ul>
<h4 id="close-the-stream">Close the Stream</h4>
<pre><code class="lang-ts">stream.close(): void
</code></pre>
<h3 id="web-monetization-handler-api">Web Monetization Handler API</h3>
<p>The <code>handlerURL</code> that is registered is embedded as an iframe. Messages are passed to it with <code>iframe.contentWindow.postMessage</code>, and messages are sent from the iframe to the browser via <code>window.parent.postMessage</code>.</p>
<h4 id="request">Request</h4>
<pre><code class="lang-ts">{
  id: string,
  request: string
}
</code></pre>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Unique ID to associate request with response.</td>
</tr>
<tr>
<td style="text-align:left">request</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Base64 encoded ILP prepare packet.</td>
</tr>
</tbody>
</table>
<h4 id="response-success">Response (Success)</h4>
<pre><code class="lang-ts">{
  id: string,
  response: string
}
</code></pre>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Unique ID to associate request with response.</td>
</tr>
<tr>
<td style="text-align:left">response</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Base64 encoded ILP fulfill/reject packet.</td>
</tr>
</tbody>
</table>
<h4 id="response-error">Response (Error)</h4>
<pre><code class="lang-ts">{
  id: string,
  error: string,
  errorName?: string
}
</code></pre>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Unique ID to associate request with response.</td>
</tr>
<tr>
<td style="text-align:left">error</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">Error message.</td>
</tr>
<tr>
<td style="text-align:left">errorName</td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left"><em>(Optional)</em> Error name.</td>
</tr>
</tbody>
</table>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
