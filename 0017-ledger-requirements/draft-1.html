<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Ledger Layer Requirements | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
              
                <li class="nav-label">
                  <a href="./draft-1.html">Permalink to this draft</a>
                </li>
              
              
                <li class="nav-label">
                  <a href="#introduction">Introduction</a>
                </li>
              
                <li class="nav-label">
                  <a href="#requirements">Requirements</a>
                </li>
              
                <li>
                  <a href="#minimal-support">Minimal Support</a>
                </li>
              
                <li>
                  <a href="#basic-support">Basic Support</a>
                </li>
              
                <li>
                  <a href="#full-support">Full Support</a>
                </li>
              
                <li class="nav-label">
                  <a href="#example-protocols">Example Protocols</a>
                </li>
              
                <li>
                  <a href="#five-bells-ledger-protocol-5blp">Five Bells Ledger Protocol (5BLP)</a>
                </li>
              
                <li>
                  <a href="#blockchain-protocols-eg-bitcoin">Blockchain Protocols (e.g. Bitcoin)</a>
                </li>
              
                <li>
                  <a href="#legacy-protocols-eg-ach-iso-20022">Legacy Protocols (e.g. ACH, ISO 20022)</a>
                </li>
              
                <li>
                  <a href="#proprietary-wallet-protocols-eg-paypal-api">Proprietary Wallet Protocols (e.g. PayPal API)</a>
                </li>
              
                <li>
                  <a href="#other-proprietary-protocols-eg-skype-api">Other Proprietary Protocols (e.g. Skype API)</a>
                </li>
              
                <li class="nav-label">
                  <a href="#appendix-a-holds-without-native-ledger-support">Appendix A: Holds Without Native Ledger Support</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
          <h1 id="ledger-layer-requirements">Ledger Layer Requirements</h1>
<h2 id="introduction">Introduction</h2>
<p class="intro">Ledger protocols are responsible for executing the individual transfers that constitute an Interledger transaction. They are also used by connectors to communicate with each other. Ledger layer protocols can differ widely depending on the type of ledger. For example, a central ledger will likely use a very different protocol than a blockchain, but for interledger purposes they are both ledgers and may be accessed using the same primitive operations as defined in this architecture.</p>
<h2 id="requirements">Requirements</h2>
<h3 id="minimal-support">Minimal Support</h3>
<p>For minimal Interledger support, a ledger MUST have the ability to transfer funds from one account to another. All additional functionality can be implemented in a separate &quot;adapter&quot; service. To use ILP in that case, users of the ledger must also trust the adapter. For further details, see <a href="#appendix-a-holds-without-native-ledger-support">Appendix A</a>.</p>
<h3 id="basic-support">Basic Support</h3>
<p>For basic Interledger support, a ledger MUST fulfill the requirements for minimal support and also the following:</p>
<p>The ledger MUST provide authorization holds, conditional upon a cryptographic hash and timeout as described below. During an authorization hold, money is put aside for a specific transfer until that transfer&apos;s outcome has been decided.</p>
<p>Transfers using authorization holds can be in four distinct states:</p>
<p><img src="../shared/graphs/transfer-states.svg" alt="Transfers start in the proposed state, transition to the prepared state and finally to the executed state, which is final. Proposed and prepared transfers can also transition to the rejected state, which is final as well." class="img-responsive"></p>
<ul>
<li>Proposed -- Nothing has happened yet.</li>
<li>Prepared -- Funds are held.</li>
<li>Executed -- The transfer has completed.</li>
<li>Rejected -- The transfer has been canceled (and funds returned to the sender.)</li>
</ul>
<p><span class="show alert alert-info"><strong>Hint:</strong> Authorization holds are the financial equivalent of a <a href="http://foldoc.org/two-phase%20commit">two-phase commit</a>.</span></p>
<p>The ledger MUST be able to release the held funds to the receiver upon receiving a 32-byte preimage whose SHA-256 hash matches a value provided by the sender. The ledger MUST accept ONLY 32 byte preimages or support specifying the fulfillment length when the transfer is prepared.</p>
<p>The ledger MUST support releasing held funds back to the sender after a timeout.</p>
<p>The ledger MUST support attaching a short message or <em>memo</em> to each transfer.</p>
<p>The ledger MUST support notifications to account holders when transfers are prepared, executed, or rejected that affect their accounts.</p>
<h3 id="full-support">Full Support</h3>
<p>The ledger MUST fulfill the requirements for basic support and also the following:</p>
<p>The ledger MUST support memos up to 65535 bytes.</p>
<p>The ledger MUST support sending an authenticated message of up to 65535 bytes to the holder of another account on the ledger.</p>
<p>The ledger MUST support a way to look up a fulfillment by condition hash. It SHOULD automatically reject new transfers (that have not been prepared yet) that have an execution condition for which the ledger already knows the fulfillment. This aids in <a href="#error-recovery">error recovery</a>.</p>
<p>The ledger MUST support preparing, executing, and rejecting transfers in 1 second or less.</p>
<p>The ledger MUST define an <a href="../0015-ilp-addresses">ILP Address</a> prefix and scheme such that accounts on the ledger can be addressed using canonical ILP addresses.</p>
<p>It MUST support receivers (and ONLY receivers) rejecting incoming transfers. Receivers MUST be able to submit a rejection message of up to 65535 bytes. The sender of the transfer MUST be notified that the transfer has been rejected and the notification MUST include the rejection message.</p>
<h2 id="example-protocols">Example Protocols</h2>
<h3 id="five-bells-ledger-protocol-5blp">Five Bells Ledger Protocol (5BLP)</h3>
<p>Five Bells Ledger Protocol (5BLP) is a RESTful, JSON-based protocol that was developed specifically to provide the minimum functionality required for full Interledger support.</p>
<p>A reference implementation of a ledger using 5BLP can be found <a href="https://github.com/interledger/five-bells-ledger">here</a>.</p>
<h3 id="blockchain-protocols-eg-bitcoin">Blockchain Protocols (e.g. Bitcoin)</h3>
<p>Blockchains are distributed, peer-to-peer systems that provide consensus over a single shared state. Any blockchain that supports escrowed funds transfers is in principle capable of acting as a ledger connected to the Interledger.</p>
<p>For example, Bitcoin supports SHA-256 hashlocked escrow transfers which means it can participate in ILP Interledger transactions. Bitcoin&apos;s <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a> proposal provided the timeouts required for Basic level support.</p>
<h3 id="legacy-protocols-eg-ach-iso-20022">Legacy Protocols (e.g. ACH, ISO 20022)</h3>
<p>Legacy protocols often do not provide escrow functionality. In this case, the protocol can either be upgraded, or a highly trusted participant (e.g. a bank) can act as an escrow provider.</p>
<h3 id="proprietary-wallet-protocols-eg-paypal-api">Proprietary Wallet Protocols (e.g. PayPal API)</h3>
<p>There are large numbers of proprietary ledgers out there. This includes web-based and mobile wallets. These types of systems can usually be extended with cryptographic escrow functionality by their operator in order to connect them to the Interledger.</p>
<h3 id="other-proprietary-protocols-eg-skype-api">Other Proprietary Protocols (e.g. Skype API)</h3>
<p>Some proprietary protocols intentionally do not provide general ledger functionality. A common example are stored-value systems, such as gift cards, loyalty points or pre-paid accounts. Such systems can still be connected to the Interledger in a limited capacity. For example a pre-paid account ledger could be set up to act as a receiving ledger, but not as a sending or intermediate ledger.</p>
<p>By creating two classes of users -- resellers and end users -- and only allowing transfers if the sender is a reseller and the recipient is a user, merchants can create Interledger-capable ledgers which behave like stored-value systems. Such systems allow deposits, but do not allow withdrawals.</p>
<h2 id="appendix-a-holds-without-native-ledger-support">Appendix A: Holds Without Native Ledger Support</h2>
<p>Not all ledgers support held transfers. In the case of a ledger that doesn&apos;t, the sender and recipient of the local ledger transfer MAY choose a commonly trusted party to carry out the hold functions. There are three options:</p>
<ol>
<li><p>The sender MAY trust the receiver. The sender will perform a regular transfer in the first step and the receiver will perform a transfer back if the condition has not been met in time.</p>
</li>
<li><p>The receiver MAY trust the sender. The sender will notify the receiver about the intent to transfer. If the receiver provides a fulfillment for the condition before the expiry date, the sender will perform a regular transfer to the receiver.</p>
</li>
<li><p>The sender and receiver MAY appoint a mutually trusted third-party which has an account on the local ledger. The sender performs a regular transfer into a neutral third-party account. In the first step, funds are transfered into the account belonging to the neutral third-party.</p>
</li>
</ol>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
