<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Interledger Payment Request (IPR) | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
              
                <li class="nav-label">
                  <a href="#preface">Preface</a>
                </li>
              
                <li class="nav-label">
                  <a href="#introduction">Introduction</a>
                </li>
              
                <li>
                  <a href="#motivation">Motivation</a>
                </li>
              
                <li>
                  <a href="#scope">Scope</a>
                </li>
              
                <li>
                  <a href="#model-of-operation">Model of Operation</a>
                </li>
              
                <li class="nav-label">
                  <a href="#payment-request-specification">Payment Request Specification</a>
                </li>
              
                <li>
                  <a href="#json">JSON</a>
                </li>
              
                <li>
                  <a href="#binary">Binary</a>
                </li>
              
                <li class="nav-label">
                  <a href="#condition-generation">Condition Generation</a>
                </li>
              
                <li>
                  <a href="#preimage-condition-from-json">Preimage Condition from JSON</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
          <h1 id="interledger-payment-request-ipr">Interledger Payment Request (IPR)</h1>
<h2 id="preface">Preface</h2>
<p class="intro">This document specifies the Interledger Payment Request (IPR) data format. It is intended for use in protocols in which the recipient of an Interledger payment first communicates a request for payment to the sender.</p>
<p>This document provides an example flow to illustrate how IPR could be used in a higher level protocol. This document also details a method for generating Interledger transfer conditions that enable recipients to use the condition as an integrity check on incoming transfers and packets, without maintaining state about all outstanding payment requests.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="motivation">Motivation</h3>
<p>The Interledger Protocol uses holds based on Crypto Conditions and expiries to ensure a sender&apos;s funds are delivered to the destination or returned to the sender&apos;s account.</p>
<p>A common approach is for conditions to be generated and fulfilled by the receivers of Interledger transfers. This document specifies one such approach that enables receivers to verify that an incoming transfer matches a payment request they previously created, without the receiver needing to keep a record of all outstanding payment requests.</p>
<h3 id="scope">Scope</h3>
<p>This document defines a suggested format for representing payment requests and an approach for receiver-generated conditions. Protocols built on top of Interledger MAY use the format provided here, though they can use any format they choose instead.</p>
<p>While this document also provides a recommendation for generating transfer conditions, conditions are often opaque to all parties aside from the receiver. Receivers MAY use any condition they choose, however this specification includes best practices that receivers SHOULD take into consideration.</p>
<p>This document does <strong>not</strong> specify how payment requests are communicated from a recipient to a sender.</p>
<h3 id="model-of-operation">Model of Operation</h3>
<p>Interledger Payment Requests are intended to be used in higher-level protocols as follows:</p>
<ol>
<li>Recipient creates the payment request and generates the condition using one of algorithms outlined in <a href="#condition-generation">Condition Generation</a>.</li>
<li>Recipient communicates the payment request to the sender.</li>
<li>Sender generates an ILP Packet from the payment request.</li>
<li>Sender prepares a local ledger transfer to a connector, held pending the execution condition given in the payment request and with the ILP Packet attached.</li>
<li>Connectors forward the payment until it reaches the recipient.</li>
<li>Recipient receives a notification of a held transfer with an ILP Packet attached.</li>
<li>Recipient checks the transfer amount against the ILP Packet and checks the payment request has not expired.</li>
<li>Recipient regenerates the condition and fulfillment from the ILP Packet attached to the incoming transfer, using the same algorithm as before, and fulfills the transfer&apos;s condition. If the condition generated does not match the one in the transfer it means that the ILP Packet has been tampered with and the transfer goes unfulfilled.</li>
</ol>
<h2 id="payment-request-specification">Payment Request Specification</h2>
<h3 id="json">JSON</h3>
<pre><code class="lang-json">{
    &quot;address&quot;: &quot;ilpdemo.red.bob.b9c4ceba-51e4-4a80-b1a7-2972383e98af&quot;,
    &quot;amount&quot;: &quot;10.25&quot;,
    &quot;condition&quot;: &quot;cc:0:3:hd5x8kpaDDLQu-KqMyCrlsg5QJ9g9qaFr9ytTwqyCsw:32&quot;,
    &quot;expires_at&quot;: &quot;2016-08-16T12:00:00Z&quot;,
    &quot;data&quot;: {
        &quot;re&quot;: &quot;dinner the other night&quot;
    },
    &quot;additional_headers&quot;: &quot;asdf98zxcvlknannasdpfi09qwoijasdfk09xcv009as7zxcv&quot;
}
</code></pre>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Field</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Short Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>address</code></td>
<td style="text-align:left">ILP Address</td>
<td style="text-align:left">Request-specific address</td>
</tr>
<tr>
<td style="text-align:left"><code>amount</code></td>
<td style="text-align:left">Decimal String</td>
<td style="text-align:left">Amount requested by the recipient</td>
</tr>
<tr>
<td style="text-align:left"><code>condition</code></td>
<td style="text-align:left">Crypto Condition</td>
<td style="text-align:left">Execution condition for the payment</td>
</tr>
<tr>
<td style="text-align:left"><code>expires_at</code></td>
<td style="text-align:left"><a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> Timestamp</td>
<td style="text-align:left">Expiry of the request</td>
</tr>
<tr>
<td style="text-align:left"><code>data</code></td>
<td style="text-align:left">Object</td>
<td style="text-align:left">Data to be included in the ILP Packet</td>
</tr>
<tr>
<td style="text-align:left"><code>additional_headers</code></td>
<td style="text-align:left">Base64 String</td>
<td style="text-align:left">Additional headers for the ILP Packet</td>
</tr>
</tbody>
</table>
<h4 id="address">address</h4>
<p>The ILP Address the payment is to be routed to. This SHOULD be a request-specific address in the form <code>&lt;account address&gt;.&lt;request ID&gt;</code>, such as <code>ilpdemo.red.bob.b9c4ceba-51e4-4a80-b1a7-2972383e98af</code>.</p>
<p>When using the recommended <a href="#condition-generation">Condition Generation</a> method, account addresses MUST include a request-specific portion to ensure that conditions are unique per-request.</p>
<h4 id="amount">amount</h4>
<p>The amount requested by the recipient, such as <code>10.25</code>, denoted in the assets of the recipient&apos;s ledger.</p>
<p>The amount MUST be rounded based on the precision supported by the recipient&apos;s ledger.</p>
<p>Recipients SHOULD ignore incoming transfers whose amounts are less than the amount specified in the payment request. Recipients MAY ignore incoming transfers whose amounts are greater than requested.</p>
<h4 id="condition">condition</h4>
<p>The Crypto Condition to be used as the execution condition for the payment. See <a href="#condition-generation">Condition Generation</a> for recommendations the recipient MAY use for creating the condition.</p>
<h4 id="expires_at">expires_at</h4>
<p>The timestamp when the request expires. Recipients SHOULD NOT fulfill the conditions of incoming transfers that arrive after the expiry has passed. Senders MAY use the request expiry to determine the expiry of the transfer they put on hold for the first connector.</p>
<h4 id="data">data</h4>
<p>An arbitrary JSON object that should be included in the ILP Packet&apos;s user data header.</p>
<h4 id="additional_headers">additional_headers</h4>
<p>Additional binary headers, encoded as a base64 string, that should be included in the ILP Packet. The sender SHOULD treat these as opaque.</p>
<h3 id="binary">Binary</h3>
<p><strong>TODO</strong></p>
<h2 id="condition-generation">Condition Generation</h2>
<p>It is RECOMMENDED that recipients use a Message Authentication Code (MAC) of the details of their payment request in the condition so that the condition can be used as an integrity check on incoming transfers. This allows a recipient to ensure that a transfer matches a request they previously generated, without the recipient needing to maintain a log of all outstanding payment requests.</p>
<p>Recipients MUST include a payment request-specific component in the account ILP Address to ensure that conditions are unique per-request.</p>
<h3 id="preimage-condition-from-json">Preimage Condition from JSON</h3>
<p>This is how a <a href="../0002-crypto-conditions">PREIMAGE-SHA-256 Crypto Condition</a> MAY be generated using an HMAC of a JSON-encoded Interledger Payment Request:</p>
<ol>
<li>The recipient takes the <code>address</code>, <code>amount</code>, <code>expires_at</code>, and <code>data</code> fields from the payment request. Any fields that are used for routing are probably not important to perform an integrity check upon, because they may be modified in transit and there is no further use for them once the ILP packet is received attached to an incoming transfer.</li>
<li>The recipient uses a canonical encoding, such as <a href="https://www.npmjs.com/package/canonical-json">Canonical JSON</a> to create a stringified version of <code>1.</code></li>
<li>The recipient uses a secret key to create an HMAC of <code>2.</code></li>
<li>The recipient uses the digest of <code>3.</code> as the preimage of a <a href="../0002-crypto-conditions">PREIMAGE-SHA-256 Crypto Condition</a>.</li>
</ol>
<p>The following snippet shows how this can be done in JavaScript:</p>
<pre><code class="lang-js">const crypto = require(&apos;crypto&apos;) // Node.js crypto
const stringify = require(&apos;canonical-json&apos;) // https://www.npmjs.com/package/canonical-json
const cc = require(&apos;five-bells-condition&apos;) // https://www.npmjs.com/package/five-bells-condition

const RECIPIENT_HMAC_KEY = Buffer.from(&apos;/4t65RDqth7/rxI0j+MqtQyv04Y8mzUCMhAAofhDQIY=&apos;, &apos;base64&apos;)
const requestString = stringify({
  &quot;address&quot;: &quot;ilpdemo.red.bob.b9c4ceba-51e4-4a80-b1a7-2972383e98af&quot;,
  &quot;amount&quot;: &quot;10.25&quot;,
  &quot;expires_at&quot;: &quot;2016-08-16T12:00:00Z&quot;,
  &quot;data&quot;: {
    &quot;re&quot;: &quot;dinner the other night&quot;
  }
})

const hmac = crypto.createHmac(&apos;sha256&apos;, RECIPIENT_HMAC_KEY)
hmac.update(requestString)
const cryptoCondition = new cc.PreimageSha256()
cryptoCondition.setPreimage(hmac.digest())

const condition = cryptoCondition.getConditionUri()
console.log(condition) // Prints cc:0:3:BC-mUTFsZYXd89QQDiocToUWbQ-XYTh5H5lFQNwhDWE:32

const fulfillment = cryptoCondition.serializeUri()
console.log(fulfillment) // Prints cf:0:aW9EFFuRmltvYcs2ESExvf-0pbzBhUGgpqKT-oUBuuU
</code></pre>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
