<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Interledger Payment Request (IPR) | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
              
                <li class="nav-label">
                  <a href="#introduction">Introduction</a>
                </li>
              
                <li>
                  <a href="#motivation">Motivation</a>
                </li>
              
                <li>
                  <a href="#scope">Scope</a>
                </li>
              
                <li>
                  <a href="#model-of-operation">Model of Operation</a>
                </li>
              
                <li class="nav-label">
                  <a href="#condition-generation-recommendations">Condition Generation Recommendations</a>
                </li>
              
                <li>
                  <a href="#using-a-psk-implementation">Using a PSK Implementation</a>
                </li>
              
                <li>
                  <a href="#alternative-methods-and-general-best-practices">Alternative Methods and General Best Practices</a>
                </li>
              
                <li class="nav-label">
                  <a href="#interledger-payment-request-format">Interledger Payment Request Format</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
          <h1 id="interledger-payment-request-ipr">Interledger Payment Request (IPR)</h1>
<p class="intro">The Interledger Payment Request (IPR) transport protocol is an end-to-end protocol in which the receiver of an Interledger payment first communicates a request for payment to the sender. This document also recommends a method for receivers to generate payment requests such that they can verify incoming payments without storing all outstanding requests.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="motivation">Motivation</h3>
<p>The Interledger Protocol uses holds based on cryptographic conditions and expiries to ensure a sender&apos;s funds are delivered to the destination or returned to the sender&apos;s account.</p>
<p>One approach is for conditions to be generated and fulfilled by the receivers of Interledger payments. When the sender of the payment receives the fulfillment, they can be certain that the receiver received the payment.</p>
<p>Receiver-generated conditions are also useful in building non-repudiable application layer protocols. The receiver would generate the condition and cryptographically sign a statement that the preimage of the specified hash indicates the sender has settled a particular debt. The receiver would only disclose the hash preimage upon receipt of payment. Once the sender gets the preimage, they would be able to demonstrate to third parties that they paid the receiver using the preimage and the original signed statement.</p>
<p>In most cases, non-repudiability is unnecessary, as it is sufficient for the sender to get proof that the receiver received the payment even if that proof cannot be used to convince third parties. In such cases, the <a href="../0016-pre-shared-key">Pre-Shared Key</a> transport protocol is recommended because it does not require end-to-end communication for every payment.</p>
<h3 id="scope">Scope</h3>
<p>This document defines a suggested format for representing payment requests and an approach for receiver-generated conditions. Protocols built on top of IPR MAY use the format provided here, though they can use any format they choose instead.</p>
<p>While this document also provides a recommendation for generating transfer conditions, conditions are often opaque to all parties aside from the receiver. Receivers MAY use any condition they choose, however this specification includes best practices that receivers SHOULD take into consideration.</p>
<p>This document does <strong>not</strong> specify how payment requests are communicated from a receiver to a sender.</p>
<h3 id="model-of-operation">Model of Operation</h3>
<p>Interledger Payment Requests are intended to be used in higher-level protocols as follows:</p>
<ol>
<li>The receiver creates the ILP Packet and generates the condition using one of algorithms outlined in <a href="#condition-generation-recommendations">Condition Generation Recommendations</a>.</li>
<li>The receiver communicates the payment request, which includes the ILP Packet and condition, to the sender.</li>
<li>The sender quotes the requested ILP packet and initiates an ILP payment with the packet and execution condition from the payment request. The sender uses the <code>account</code> and <code>amount</code> from the packet but they MUST treat the <code>data</code> as opaque. The sender MUST NOT modify the packet at all, or the receiver will reject the payment.</li>
<li>When the receiver gets a notification of the incoming transfer, they check the transfer amount against the ILP Packet and check the payment request has not expired.</li>
<li>The receiver regenerates the condition and fulfillment from the ILP Packet attached to the incoming transfer, using the same algorithm as before, and fulfills the transfer&apos;s condition.</li>
<li>If the condition generated by the receiver matches the one in the incoming transfer, they submit the fulfillment to execute the transfer. If the condition does not match, it means that the ILP Packet has been tampered with and the receiver rejects the incoming transfer.</li>
</ol>
<h2 id="condition-generation-recommendations">Condition Generation Recommendations</h2>
<p>It is RECOMMENDED that receivers use an implementation of the <a href="../0016-pre-shared-key">Pre-Shared Key</a> transport protocol to generate the packet and condition, because it will already include the best practices for generating conditions and enable the receiver to avoid keeping state of all outstanding payment requests.</p>
<p>Note the receiver&apos;s method for generating the condition or encoding data in the ILP packet does not matter to the sender. The sender treats the <code>data</code> in the ILP packet as opaque and uses the condition from the payment request without needing to know how the fulfillment is generated.</p>
<h3 id="using-a-psk-implementation">Using a PSK Implementation</h3>
<p>The <a href="../0016-pre-shared-key">Pre-Shared Key</a> protocol uses the payment condition as a MAC of the payment details by setting the fulfillment to be an HMAC of the ILP packet with a key derived from a secret shared between the sender and receiver. In IPR there is no shared secret and the condition is only generated by the receiver. Nevertheless, an IPR receiver can use the same methods to generate the condition and regenerate the fulfillment on receipt of the incoming transfer.</p>
<p>To use a PSK implementation, the receiver follows these steps:</p>
<ol>
<li>The receiver MAY derive a receiver secret and address as detailed in <a href="../0016-pre-shared-key/0016-pre-shared-key.md#shared-secret-generation">PSK: Shared Secret Generation</a> but in IPR the receiver MUST NOT share the secret key.</li>
<li>The receiver creates the payment packet and condition <em>using the steps normally executed by the sender</em>: <a href="../0016-pre-shared-key/0016-pre-shared-key.md#1-payment-creation">PSK: Payment Creation</a>.</li>
<li>The receiver communicates the payment request, including the packet and condition, to the sender.</li>
<li>If the receiver used the derived secret from step 1, they regenerate that secret from the packet as specified in <a href="../0016-pre-shared-key/0016-pre-shared-key.md#shared-secret-regeneration">PSK: Shared Secret Regeneration</a>.</li>
<li>The receiver generates the fulfillment from the secret and packet as specified in <a href="../0016-pre-shared-key/0016-pre-shared-key.md#2-payment-fulfillment">PSK: Payment Fulfillment</a>.</li>
</ol>
<h3 id="alternative-methods-and-general-best-practices">Alternative Methods and General Best Practices</h3>
<p>Receivers MAY use any method they choose for generating the condition, such as using a random fulfillment for each request. The receiver MUST be able to identify and verify the ILP Packet for every outstanding payment and produce the corresponding fulfillment. A PSK implementation handles these requirements without storing every fulfillment and packet in a database, by using the condition as a Message Authentication Code (MAC) of the payment request.</p>
<p>Receivers SHOULD follow these guidelines if implementing a custom system:</p>
<ul>
<li>Receivers SHOULD include a payment request-specific nonce in the ILP packet to ensure that conditions are unique even when multiple payments would otherwise have identical packets.</li>
<li>Receivers SHOULD include an expiry date so that they do not accept incoming payments that are paid too long after their creation.</li>
</ul>
<h2 id="interledger-payment-request-format">Interledger Payment Request Format</h2>
<p>Here is a summary of the fields in the Interledger Payment Request format:</p>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left">Field</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Short Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>version</code></td>
<td style="text-align:left">UInt8</td>
<td style="text-align:left">IPR Version, <code>2</code> for now</td>
</tr>
<tr>
<td style="text-align:left"><code>packet</code></td>
<td style="text-align:left">OCTET STRING</td>
<td style="text-align:left">ILP Payment packet including the destination address and amount</td>
</tr>
<tr>
<td style="text-align:left"><code>condition</code></td>
<td style="text-align:left">UInt256</td>
<td style="text-align:left">Execution condition for the payment</td>
</tr>
</tbody>
</table>
<h4 id="version">version</h4>
<pre><code>UInt8 ::= INTEGER (0..127)
</code></pre><p>IPR version. This document specifies version 2.</p>
<h4 id="packet">packet</h4>
<pre><code>OCTET STRING (SIZE(0..65535))
</code></pre><p>The <a href="../0003-interledger-protocol/0003-interledger-protocol.md#specification">ILP Payment Packet</a>.</p>
<p>In IPR the sender only uses the <code>account</code> and <code>amount</code> from the ILP packet and MUST treat the <code>data</code> as opaque.</p>
<p>The sender MUST NOT modify the ILP packet at all, or the receiver will reject the payment.</p>
<h4 id="condition">condition</h4>
<pre><code>UInt256 ::= OCTET STRING (SIZE(32))
</code></pre><p>The ILP payment condition, which is the SHA-256 hash of the fulfillment that will be used to trigger the execution of the payment.</p>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
