<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Payments across payment networks">

    <title>Interledger Architecture | Interledger</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/css/monokai-sublime.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

    <link href="/assets/favicon.ico" rel="icon" type="image/x-icon">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target="#myScrollspy" data-offset="160" class="spec">

     <!-- navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img class="logo" alt="interledger" src="/assets/ilp_icon.png"/></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/overview.html">Docs</a></li>
              <li><a href="/community.html">Community</a></li>
              <li><a href="/news.html">News</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a target="_blank" href="https://github.com/interledger">Github</a></li>
            </ul>
          </div>
        </div>
      </nav>

    <!-- docs overview section -->

    <div class="container docs-wrapper">
      <div class="row">
        <div id="sidebarContent">
          <nav class="col-sm-4" id="myScrollspy">
            <ul class="nav-fixed nav nav-sidebar">
              <div class="overview-back"><a href="/overview.html"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Back to Overview</a></div>
              
                <li class="nav-label">
                  <a href="#introduction-1">Introduction</a>
                </li>
              
                <li class="nav-label">
                  <a href="#the-interledger-architecture">The Interledger Architecture</a>
                </li>
              
                <li>
                  <a href="#architectural-assumptions">Architectural Assumptions</a>
                </li>
              
                <li>
                  <a href="#interledger-protocol-suite">Interledger Protocol Suite</a>
                </li>
              
                <li class="nav-label">
                  <a href="#ledger-layer-requirements">Ledger Layer Requirements</a>
                </li>
              
                <li>
                  <a href="#introduction-2">Introduction</a>
                </li>
              
                <li>
                  <a href="#requirements">Requirements</a>
                </li>
              
                <li>
                  <a href="#example-protocols">Example Protocols</a>
                </li>
              
                <li class="nav-label">
                  <a href="#interledger-layer-2">Interledger Layer</a>
                </li>
              
                <li>
                  <a href="#introduction-3">Introduction</a>
                </li>
              
                <li>
                  <a href="#protocols-1">Protocols</a>
                </li>
              
                <li class="nav-label">
                  <a href="#transport-layer-2">Transport Layer</a>
                </li>
              
                <li>
                  <a href="#introduction-4">Introduction</a>
                </li>
              
                <li>
                  <a href="#protocols-2">Protocols</a>
                </li>
              
                <li class="nav-label">
                  <a href="#application-layer-2">Application Layer</a>
                </li>
              
                <li>
                  <a href="#introduction-5">Introduction</a>
                </li>
              
                <li>
                  <a href="#simple-payment-setup-protocol-spsp">Simple Payment Setup Protocol (SPSP)</a>
                </li>
              
                <li>
                  <a href="#defining-other-application-layer-protocols">Defining Other Application Layer Protocols</a>
                </li>
              
                <li class="nav-label">
                  <a href="#appendix-a-holds-without-native-ledger-support">Appendix A: Holds Without Native Ledger Support</a>
                </li>
              
            </ul>
          </nav>
        </div>
        <div class="col-sm-8 markdown-body">
          <h1 id="interledger-architecture">Interledger Architecture</h1>
<p class="intro">This document outlines the Interledger architecture and explains how the different layers relate to each other. The <a href="#interledger-protocol-ilp">Interledger Protocol (ILP)</a> is one layer in the Interledger architecture.</p>
<p>The Interledger architecture is heavily inspired by the Internet architecture described in <a href="https://tools.ietf.org/html/rfc1122">RFC 1122</a>, <a href="https://tools.ietf.org/html/rfc1123">RFC 1123</a> and <a href="https://tools.ietf.org/html/rfc1009">RFC 1009</a>.</p>
<h2 id="introduction-1">Introduction</h2>
<p>This document is intended to provide an overview over the Interledger architecture and protocol suite.</p>
<h2 id="the-interledger-architecture">The Interledger Architecture</h2>
<p>All electronic transfers have to be recorded in stateful systems. Otherwise the same instance of an asset could be sent to two different destinations, essentially duplicating the asset. This is also known as a double-spend. We call these stateful systems <em>ledgers</em>.</p>
<p>Ledgers consist of <em>accounts</em>. Accounts are individual buckets containing a decimal amount of one type of asset, usually (but not always) associated with an owner. This amount is also called the account&apos;s <em>balance</em>. Balances can be positive or negative, representing assets or liabilities.</p>
<p>Assets can be transferred between accounts on the same ledger. We call these events <em>book transfers</em> or just <em>transfers</em>.</p>
<p>A transfer of assets across ledgers requires two or more local book transfers. Some system must know the relationship between the two transfers. We call this system a <em>connector</em>. The same system may act as both a ledger and a connector.</p>
<p>The Interledger is a network of independent and diverse ledgers. Each account is part of a particular ledger; the Interledger itself is only conceptual.</p>
<h3 id="architectural-assumptions">Architectural Assumptions</h3>
<h4 id="ledgers-contain-only-one-type-of-asset">Ledgers contain only one type of asset.</h4>
<p>We assume that all assets within one ledger are fungible. Within one ledger transfers can happen directly from sender to recipient and do not require a third party exchanger.</p>
<p>When a single organization such as a bank manages accounts in multiple different assets of different types, we treat each asset as belonging to its own ledger.</p>
<h4 id="connectors-do-not-keep-transfer-state-information">Connectors do not keep transfer state information.</h4>
<p>Just as Internet gateways do not keep connection state information, connectors do not keep transfer state information. All state is kept at the ledger level and connectors merely react to and trigger ledger events.</p>
<p>Note that this does not mean that all connectors are necessarily stateless. They may keep track of their available liquidity or even maintain an internal ledger if they are transacting on behalf of third parties. But we are assuming that they do not keep authoritative state about transfers.</p>
<h4 id="routing-complexity-should-be-in-the-connectors">Routing complexity should be in the connectors.</h4>
<p>Routing is a complex and difficult problem, and ought to be performed by the connectors, not the end users of the system. An important objective is to isolate user software from changes caused by the inevitable evolution of the Interledger routing architecture.</p>
<h4 id="the-system-must-tolerate-wide-ledger-variation">The system must tolerate wide ledger variation.</h4>
<p>A basic objective of the Interledger design is to tolerate a wide range of ledger characteristics --- e.g. throughput, latency, fees, access restrictions, reliability, decentralization. In addition it must support all types of different asset characteristics --- e.g. divisibility, fungibility, interest/demurrage, issuance.</p>
<h3 id="interledger-protocol-suite">Interledger Protocol Suite</h3>
<p>The Interledger architecture is separated into four layers:</p>
<p><img src="../shared/graphs/interledger-model.svg" alt="Interledger architecture layers" class="img-responsive"></p>
<h4 id="application-layer-1">Application Layer</h4>
<p>The application layer is the top layer of the Interledger protocol suite. Protocols on this layer are responsible for negotiating the key properties of a payment:</p>
<ul>
<li>Source Account</li>
<li>Destination Account</li>
<li>Destination Amount</li>
</ul>
<p>Once these parameters are decided, the application layer protocol will instantiate a transport layer protocol to initiate the payment.</p>
<p>An example of an application layer protocol is the <a href="#simple-payment-setup-protocol-spsp">Simple Payment Setup Protocol (SPSP)</a>.</p>
<h4 id="transport-layer-1">Transport Layer</h4>
<p>The transport layer is responsible for two things:</p>
<ul>
<li>Generating the condition</li>
<li>Encoding (e.g. encrypting) the application layer data</li>
</ul>
<p>There are currently two transport layer protocols:</p>
<ul>
<li><p><a href="#pre-shared-key-psk">Pre-Shared Key (PSK)</a></p>
<p>  The sender and recipient agree upon a secret key in advance. The sender uses this key to generate the condition and encrypt the application data. The recipient uses the same key to generate the fulfillment and decrypt the application data.</p>
</li>
<li><p><a href="#interledger-payment-request-ipr">Interledger Payment Request (IPR)</a></p>
<p>  The recipient generates the condition during the quoting phase, and the sender cannot know the fulfillment until the recipient uses it to execute the payment. This is useful for building non-repudiable application layer protocols.</p>
</li>
</ul>
<h4 id="interledger-layer-1">Interledger Layer</h4>
<p>All Interledger transport protocols use the <a href="#interledger-protocol-ilp">Interledger Protocol (ILP)</a> to communicate with connectors about transfer requests. This may include requesting a quote or requesting a transfer on another ledger.</p>
<p>The Interledger layer defines a standard way to refer to ledgers, accounts and amounts. This is used in routing as well as to try and make quotes comparable.</p>
<h4 id="ledger-layer">Ledger Layer</h4>
<p>In order to facilitate transfers between accounts, ledgers must implement some API or protocol. This is called the ledger layer. There is a wide variety of ledger layer protocols, corresponding to the many different types of ledger.</p>
<h2 id="ledger-layer-requirements">Ledger Layer Requirements</h2>
<h3 id="introduction-2">Introduction</h3>
<p>Ledger protocols are responsible for executing the individual transfers that constitute an Interledger transaction. They are also used by connectors to communicate with each other. Ledger layer protocols can differ widely depending on the type of ledger. For example, a central ledger will likely use a very different protocol than a blockchain, but for interledger purposes they are both ledgers and may be accessed using the same primitive operations as defined in this architecture.</p>
<h3 id="requirements">Requirements</h3>
<h4 id="minimal-support">Minimal Support</h4>
<p>For minimal Interledger support, a ledger MUST have the ability to transfer funds from one account to another. All additional functionality can be implemented in a separate &quot;adapter&quot; service. To use ILP in that case, users of the ledger must also trust the adapter. For further details, see <a href="#appendix-a-holds-without-native-ledger-support">Appendix A</a>.</p>
<h4 id="basic-support">Basic Support</h4>
<p>For basic Interledger support, a ledger MUST fulfill the requirements for minimal support and also the following:</p>
<p>The ledger MUST provide authorization holds, conditional upon a cryptographic hash and timeout as described below. During an authorization hold, money is put aside for a specific transfer until that transfer&apos;s outcome has been decided.</p>
<p>Transfers using authorization holds can be in four distinct states:</p>
<p><img src="../shared/graphs/transfer-states.svg" alt="Transfers start in the proposed state, transition to the prepared state and finally to the executed state, which is final. Proposed and prepared transfers can also transition to the rejected state, which is final as well." class="img-responsive"></p>
<ul>
<li>Proposed -- Nothing has happened yet.</li>
<li>Prepared -- Funds are held.</li>
<li>Executed -- The transfer has completed.</li>
<li>Rejected -- The transfer has been canceled (and funds returned to the sender.)</li>
</ul>
<p><span class="show alert alert-info"><strong>Hint:</strong> Authorization holds are the financial equivalent of a <a href="http://foldoc.org/two-phase%20commit">two-phase commit</a>.</span></p>
<p>The ledger MUST be able to release the held funds to the receiver upon receiving a 32-byte preimage whose SHA-256 hash matches a value provided by the sender. The ledger MUST accept ONLY 32 byte preimages or support specifying the fulfillment length when the transfer is prepared.</p>
<p>The ledger MUST support releasing held funds back to the sender after a timeout.</p>
<p>The ledger MUST support attaching a short message or <em>memo</em> to each transfer.</p>
<p>The ledger MUST support notifications to account holders when transfers are prepared, executed, or rejected that affect their accounts.</p>
<h4 id="full-support">Full Support</h4>
<p>The ledger MUST fulfill the requirements for basic support and also the following:</p>
<p>The ledger MUST support memos up to 65535 bytes.</p>
<p>The ledger MUST support sending an authenticated message of up to 65535 bytes to the holder of another account on the ledger.</p>
<p>The ledger MUST support a way to look up a fulfillment by condition hash. It SHOULD automatically reject new transfers (that have not been prepared yet) that have an execution condition for which the ledger already knows the fulfillment. This aids in <a href="#error-recovery">error recovery</a>.</p>
<p>The ledger MUST support preparing, executing, and rejecting transfers in 1 second or less.</p>
<p>The ledger MUST define an <a href="../0015-ilp-addresses/0015-ilp-addresses.md">ILP Address</a> prefix and scheme such that accounts on the ledger can be addressed using canonical ILP addresses.</p>
<h3 id="example-protocols">Example Protocols</h3>
<h4 id="five-bells-ledger-protocol-5blp">Five Bells Ledger Protocol (5BLP)</h4>
<p>Five Bells Ledger Protocol (5BLP) is a RESTful, JSON-based protocol that was developed specifically to provide the minimum functionality required for full Interledger support.</p>
<p>A reference implementation of a ledger using 5BLP can be found <a href="https://github.com/interledger/five-bells-ledger">here</a>.</p>
<h4 id="blockchain-protocols-eg-bitcoin">Blockchain Protocols (e.g. Bitcoin)</h4>
<p>Blockchains are distributed, peer-to-peer systems that provide consensus over a single shared state. Any blockchain that supports escrowed funds transfers is in principle capable of acting as a ledger connected to the Interledger.</p>
<p>For example, Bitcoin supports SHA-256 hashlocked escrow transfers which means it can participate in ILP Interledger transactions. Bitcoin&apos;s <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a> proposal provided the timeouts required for Basic level support.</p>
<h4 id="legacy-protocols-eg-ach-iso-20022">Legacy Protocols (e.g. ACH, ISO 20022)</h4>
<p>Legacy protocols often do not provide escrow functionality. In this case, the protocol can either be upgraded, or a highly trusted participant (e.g. a bank) can act as an escrow provider.</p>
<h4 id="proprietary-wallet-protocols-eg-paypal-api">Proprietary Wallet Protocols (e.g. PayPal API)</h4>
<p>There are large numbers of proprietary ledgers out there. This includes web-based and mobile wallets. These types of systems can usually be extended with cryptographic escrow functionality by their operator in order to connect them to the Interledger.</p>
<h4 id="other-proprietary-protocols-eg-skype-api">Other Proprietary Protocols (e.g. Skype API)</h4>
<p>Some proprietary protocols intentionally do not provide general ledger functionality. A common example are stored-value systems, such as gift cards, loyalty points or pre-paid accounts. Such systems can still be connected to the Interledger in a limited capacity. For example a pre-paid account ledger could be set up to act as a receiving ledger, but not as a sending or intermediate ledger.</p>
<p>By creating two classes of users -- resellers and end users -- and only allowing transfers if the sender is a reseller and the recipient is a user, merchants can create Interledger-capable ledgers which behave like stored-value systems. Such systems allow deposits, but do not allow withdrawals.</p>
<h2 id="interledger-layer-2">Interledger Layer</h2>
<h3 id="introduction-3">Introduction</h3>
<p>The Interledger Protocol (ILP) ensures that different connectors are interoperable and can work together to route transactions.</p>
<h3 id="protocols-1">Protocols</h3>
<h4 id="interledger-protocol-ilp">Interledger Protocol (ILP)</h4>
<p>When initiating an Interledger transaction, the sender will make a transfer to a connector using their local Ledger layer protocol. Within this transfer, the sender will include an <a href="../0003-interledger-protocol/">ILP Packet</a> which tells the receiving connector the final destination, the amount to be transferred and -- if applicable -- the condition.</p>
<p>Note that the exact method of transmitting this data packet is dependent on the ledger layer protocol. Typically, it will be included in the transfer in a memo field. However, some ledgers may specify a different method for transporting the ILP packet.</p>
<p>The protocol is specified in <a href="../0003-interledger-protocol/0003-interledger-protocol.md">IL-RFC 3</a> and the flow is described in the <a href="https://interledger.org/interledger.pdf">Interledger whitepaper</a>.</p>
<p><span class="show alert alert-info"><strong>Note:</strong> Interledger only supports Universal mode as described in the whitepaper. Atomic mode can be used by adjacent subsets of participants in an Interledger payment if desired, however this is not part of the standard.</span></p>
<h5 id="error-recovery">Error Recovery</h5>
<p>An ILP execution chain can be interrupted if a connector fails to deliver the condition fulfillment. In this case, the sender thinks the transaction failed and retries it using the same condition as the original transaction. At some point during the retry, a connector inevitably prepares a transfer on a ledger which already knows the corresponding fulfillment. (This may be the recipient&apos;s ledger or a ledger before it in the chain.) When this happens, the ledger fails the transfer and provides the fulfillment to the connector which prepared it. This connector can pass the fulfillment back up the chain to receive money without sending any.</p>
<p>In other words, the failed connector loses money and some other connector gains money, but from the sender and the recipient&apos;s perspective everything has executed normally.</p>
<h4 id="interledger-quoting-protocol-ilqp">Interledger Quoting Protocol (ILQP)</h4>
<p>Before an Interledger payment occurs, the sender requests quotes from connectors which are connected to the same ledger as the sender. The sender and the connector use the <a href="../0008-interledger-quoting-protocol/">Interledger Quoting Protocol</a> to communicate these quotes.</p>
<p>Senders MAY cache quotes and send repeated transfers through the same connector.</p>
<h2 id="transport-layer-2">Transport Layer</h2>
<h3 id="introduction-4">Introduction</h3>
<p>Transport layer protocols used by the senders and receivers of Interledger payments to determine the payment condition and other details. The guarantees afforded to the sender vary depending on the type of transport protocol used.</p>
<h3 id="protocols-2">Protocols</h3>
<h4 id="pre-shared-key-psk">Pre-Shared Key (PSK)</h4>
<p>The Pre-Shared Key (PSK) protocol is an end-to-end protocol in which the sender and receiver use a shared secret to generate the payment condition, authenticate the ILP packet, and encrypt application data. Using PSK, the sender is guaranteed that fulfillment of their transfer indicates the receiver got the payment, provided that no one aside from the sender and receiver have the secret and the sender did not submit the fulfillment. PSK is recommended for most use cases.</p>
<p>The protocol is specified in <a href="../0016-pre-shared-key/0016-pre-shared-key.md">IL-RFC 16</a>.</p>
<h4 id="interledger-payment-request-ipr">Interledger Payment Request (IPR)</h4>
<p>The Interledger Payment Request (IPR) protocol is an end-to-end protocol in which the receiver generates the payment details and condition. In IPR, the sender does not share the secret used to generate the condition and fulfillment with the sender or anyone else, but the sender must ask the recipient to generate and share a condition before sending each payment. IPR is primarily useful for building non-repudiable application layer protocols, in which the sender&apos;s posession of the fulfillment proves to third parties that the sender has paid the receiver for a specific obligation.</p>
<p>The protocol is specified in <a href="../0011-interledger-payment-request/0011-interledger-payment-request.md">IL-RFC 11</a>.</p>
<h2 id="application-layer-2">Application Layer</h2>
<h3 id="introduction-5">Introduction</h3>
<p>Application layer protocols deal with the exchange of payment details and associated negotiation.</p>
<h3 id="simple-payment-setup-protocol-spsp">Simple Payment Setup Protocol (SPSP)</h3>
<p>The Simple Payment Setup Protocol (SPSP) is an application layer protocol for negotiating payment details. SPSP handles account and amount discovery, condition creation, quoting and setup. SPSP uses Webfinger (<a href="https://tools.ietf.org/html/rfc7033">RFC 7033</a>) and an HTTP-based protocol for querying account and amount details, <a href="#interledger-quoting-protocol-ilqp">ILQP</a> for quoting, and <a href="#interledger-protocol-ilp">ILP</a> for payment execution.</p>
<p>The protocol is described in <a href="../0009-simple-payment-setup-protocol/0009-simple-payment-setup-protocol.md">IL-RFC 9</a>.</p>
<h3 id="defining-other-application-layer-protocols">Defining Other Application Layer Protocols</h3>
<p>Creators of other application layer protocols should consider the following:</p>
<ol>
<li>Account discovery</li>
<li>Amount and condition negotiation and communication</li>
<li>Additional details communicated in ILP packet data</li>
<li>Transport protocol</li>
</ol>
<h2 id="appendix-a-holds-without-native-ledger-support">Appendix A: Holds Without Native Ledger Support</h2>
<p>Not all ledgers support held transfers. In the case of a ledger that doesn&apos;t, the sender and recipient of the local ledger transfer MAY choose a commonly trusted party to carry out the hold functions. There are three options:</p>
<ol>
<li><p>The sender MAY trust the receiver. The sender will perform a regular transfer in the first step and the receiver will perform a transfer back if the condition has not been met in time.</p>
</li>
<li><p>The receiver MAY trust the sender. The sender will notify the receiver about the intent to transfer. If the receiver provides a fulfillment for the condition before the expiry date, the sender will perform a regular transfer to the receiver.</p>
</li>
<li><p>The sender and receiver MAY appoint a mutually trusted third-party which has an account on the local ledger. The sender performs a regular transfer into a neutral third-party account. In the first step, funds are transfered into the account belonging to the neutral third-party.</p>
</li>
</ol>

        </div>
      </div>

    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="col-sm-4 col-xs-12">
              <p>Interledger Team</p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="text-center">See list of <a target="_blank" href="https://www.w3.org/community/interledger/participants">Contributors</a></p>
            </div>
            <div class="col-sm-4 col-xs-12">
              <p class="pull-right">Documentation licensed under <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68500608-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
