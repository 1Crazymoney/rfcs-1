# ILP Packet (DRAFT)

The Internet Protocol is comprised of a format for blocks of data, a method for fragmenting large blocks, and a means of addressing final recipient so the data can be routed to them across different physical networks.

The Interledger Protocol is similarly a protocol for routing packets, though ILP packets contain instructions for transfering value as well as information.

Packets are generated by the sender's client, passed on by each connector to help route money and/or data, and are used by the final connector in the route to create the destination transfer.

## Abstract Definition

ILP can be used across ledgers using different communcication protocols. As such, there is one definition of the semantics of the packet but multiple syntaxes for different data formats.

### Fields

| Field | Description |
|:-:|---|
| `version` | `1` |
| `destination` | Interchangeable addresses for the destination account (similar to having multilple IP addresses). Connectors should ignore any address formats they do not understand.  |
| `destinationAmount` | Amount the destination account should receive, denoted in the asset of the destination ledger |
| `data` | Message or other data to be delivered to the destination account along with the payment (i.e. destination credit memo) |
| `condition` | See the [condition spec](https://interledger.org/five-bells-condition/spec.html). The condition may be included in the packet or may be transmitted through the ledger layer. |
| `destinationPrepareBy` | Time before which the destination transfer should be prepared to ensure that the receiver has sufficient time to fulfill the condition |
| `destinationExpireBy` | Time after which the receiver will no longer attempt to fulfill the condition |
| `additionalRoutingInfo` | Extra details used by connectors to route the packet |

**TODO**: should we have the `sourceAddress` for sending error messages back?
**TODO**: should atomic mode info go in the `additionalRoutingInfo`?

### ASN.1 Definition

```
--<ASN1.PDU IlpPacket.Packet>--

IlpPacket DEFINITIONS AUTOMATIC TAGS ::= BEGIN

  Packet ::= SEQUENCE {
    version INTEGER (0..65535),
    destination IlpDirectionSet,
    destinationAmount IlpAmount,
    data IlpData OPTIONAL,
    condition IlpCondition OPTIONAL,
    destinationPrepareBy IlpTimestamp OPTIONAL,
    destinationExpireBy IlpTimestamp OPTIONAL,
    additionalRoutingInfo IlpRoutingInfoSet OPTIONAL
  }

  IlpDirectionSet ::= SEQUENCE OF IlpDirection

  -- list of ledger names separated by the slash ("/") character
  -- e.g. ilp:centralbank/acme/foo/bob
  IlpDirection ::= UTF8String

  IlpAmount ::= SEQUENCE {
    mantissa INTEGER,
    exponent INTEGER (-128..127)
  }

  -- TODO what's the size?
  IlpData ::= OCTET STRING

  IlpCondition ::= OCTET STRING

  IlpRoutingInfoSet ::= SEQUENCE OF IlpRoutingInfo

  IlpRoutingInfo ::= SEQUENCE {
    type INTEGER (0..65535),
    data OCTET STRING
  }

  -- UNIX Epoch Time
  IlpTimestamp ::= INTEGER (0..18446744073709551615)

END
```

## Syntaxes

### JSON

```js
{
  "version": 1,
  "destination": [
    "https://far-far-away-ledger.example/accounts/bob",
    "ilp:well-known-ledger/regional-ledger/bobs-ledger/bob#receiver",
    "ilp:other-big-ledger/big-bank/bobs-ledger/bob#receiver"
  ],
  "destinationAmount": "10",
  // TODO string or buffer?
  "data": "hello",
  "condition": "cc:0:3:47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU:0",
  // TODO Unix time or ISO 8601?
  "destinationPrepareBy": "1463507393799",
  "destinationExpireBy": "1463507414932",
  "additionalRoutingInfo": [{
    "type": 1,
    "data": {
      "destinationTransferId": "d9716354-6961-48b2-ac1a-3d46cdc03c5d"
    }
  }]
}
```
